# *****************************************************************************
#
#  Licensed to the Apache Software Foundation (ASF) under one
#  or more contributor license agreements.  See the NOTICE file
#  distributed with this work for additional information
#  regarding copyright ownership.  The ASF licenses this file
#  to you under the Apache License, Version 2.0 (the
#  "License"); you may not use this file except in compliance
#  with the License.  You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing,
#  software distributed under the License is distributed on an
#  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#  KIND, either express or implied.  See the License for the
#  specific language governing permissions and limitations
#  under the License.
#
# ******************************************************************************

<#include "ssn.yml">

<#if CLOUD_TYPE == "aws">
# Minimum and maximum number of slave EMR instances than could be created
minEmrInstanceCount: 2
maxEmrInstanceCount: 14
# Minimum and maximum percentage cost for slave EMR spot instances biding
minEmrSpotInstanceBidPct: 20
maxEmrSpotInstanceBidPct: 90
</#if>

<#if CLOUD_TYPE == "gcp">
# Maximum length for gcp user name (due to gcp restrictions)
maxUserNameLength: 10
# Minimum and maximum number of slave Dataproc instances that could be created
minInstanceCount: 3
maxInstanceCount: 15
minDataprocPreemptibleCount: 0
gcpOuauth2AuthenticationEnabled: false
</#if>

# Boundaries for Spark cluster creation
minSparkInstanceCount: 2
maxSparkInstanceCount: 14

# Timeout for check the status of environment via provisioning service
checkEnvStatusTimeout: 5m

# Restrict access to DLab features using roles policy
rolePolicyEnabled: true
# Default access to DLab features using roles policy
roleDefaultAccess: true

# Set to true to enable the scheduler of billing report.
billingSchedulerEnabled: false
# Name of configuration file for billing report.
<#if DEV_MODE == "true">
billingConfFile: ${sys['user.dir']}/../billing/billing.yml
<#else>
billingConfFile: ${DLAB_CONF_DIR}/billing.yml
</#if>

<#if CLOUD_TYPE == "azure">
azureUseLdap: <LOGIN_USE_LDAP>
maxSessionDurabilityMilliseconds: 288000000
</#if>

server:
  gzip:
    enabled: true
  requestLog:
    appenders:
      - type: file
        currentLogFilename: ${LOG_ROOT_DIR}/ssn/request-selfservice.log
        archive: true
        archivedLogFilenamePattern: ${LOG_ROOT_DIR}/ssn/request-selfservice-%d{yyyy-MM-dd}.log.gz
        archivedFileCount: 10
  rootPath: "/api"
  applicationConnectors:
    #    - type: http
    #      port: 8080
    - type: https
      port: 8443
      certAlias: dlab
      validateCerts: false
      keyStorePath: ${KEY_STORE_PATH}
      keyStorePassword: ${KEY_STORE_PASSWORD}
      trustStorePath: ${TRUST_STORE_PATH}
      trustStorePassword: ${TRUST_STORE_PASSWORD}
  adminConnectors:
    #    - type: http
    #      port: 8081
    - type: https
      port: 8444
      certAlias: dlab
      validateCerts: false
      keyStorePath: ${KEY_STORE_PATH}
      keyStorePassword: ${KEY_STORE_PASSWORD}
      trustStorePath: ${TRUST_STORE_PATH}
      trustStorePassword: ${TRUST_STORE_PASSWORD}

mongoMigrationEnabled: false

logging:
  level: INFO
  loggers:
    com.epam: INFO
    org.apache.guacamole: DEBUG
    com.novemberain: ERROR
    io.swagger.v3: DEBUG
  appenders:
 <#if DEV_MODE == "true">
  - type: console
 </#if>
  - type: file
    currentLogFilename: ${LOG_ROOT_DIR}/ssn/selfservice.log
    archive: true
    archivedLogFilenamePattern: ${LOG_ROOT_DIR}/ssn/selfservice-%d{yyyy-MM-dd}.log.gz
    archivedFileCount: 10

swaggerConfiguration:
  resourcePackage: com.epam.dlab.backendapi.resources
  title: DLab API
  description: Essential toolset for analytics. Deployed on ${CLOUD_TYPE} provider
  schemes: [https, http]
  version: 2.0
  contact: DLab
  contactUrl: http://dlab.opensource.epam.com/
  license: Apache 2.0
  licenseUrl: https://www.apache.org/licenses/LICENSE-2.0

mavenSearchService:
  protocol: http
  host: search.maven.org
  port: 80
  jerseyClient:
    timeout: 5s
    connectionTimeout: 5s

schedulers:
  inactivity:
    enabled: false
    cron: "0 0 0/2 ? * * *"
  startComputationalScheduler:
    enabled: true
    cron: "*/20 * * ? * * *"
  stopComputationalScheduler:
    enabled: true
    cron: "*/20 * * ? * * *"
  startExploratoryScheduler:
    enabled: true
    cron: "*/20 * * ? * * *"
  stopExploratoryScheduler:
    enabled: true
    cron: "*/20 * * ? * * *"
  terminateComputationalScheduler:
    enabled: true
    cron: "*/20 * * ? * * *"
  checkQuoteScheduler:
    enabled: true
    cron: "0 0 * ? * * *"
  checkUserQuoteScheduler:
    enabled: false
    cron: "0 0 * ? * * *"
  checkProjectQuoteScheduler:
    enabled: true
    cron: "0 * * ? * * *"


guacamole:
  connectionProtocol: ssh
  serverHost: localhost
  serverPort: 4822
  port: 22
  username: dlab-user

keycloakConfiguration:
  realm: KEYCLOAK_REALM_NAME
  bearer-only: true
  auth-server-url: KEYCLOAK_AUTH_SERVER_URL
  ssl-required: none
  register-node-at-startup: true
  register-node-period: 600
  resource: KEYCLOAK_CLIENT_NAME
  credentials:
    secret: KEYCLOAK_CLIENT_SECRET

jerseyClient:
  minThreads: 1
  maxThreads: 128
  workQueueSize: 8
  gzipEnabled: true
  gzipEnabledForRequests: false
  chunkedEncodingEnabled: true

cloudProperties:
  os: CONF_OS
  serviceBaseName: SERVICE_BASE_NAME
  edgeInstanceSize: EDGE_INSTANCE_SIZE
  subnetId: SUBNET_ID
  region: REGION
  zone: ZONE
  confTagResourceId: TAG_RESOURCE_ID
  securityGroupIds: SG_IDS
  ssnInstanceSize: SSN_INSTANCE_SIZE
  notebookVpcId: VPC2_ID
  notebookSubnetId: SUBNET2_ID
  confKeyDir: CONF_KEY_DIR
  vpcId: VPC_ID
  peeringId: PEERING_ID
  azureResourceGroupName: AZURE_RESOURCE_GROUP_NAME
  ssnStorageAccountTagName: AZURE_SSN_STORAGE_ACCOUNT_TAG
  sharedStorageAccountTagName: AZURE_SHARED_STORAGE_ACCOUNT_TAG
  datalakeTagName: AZURE_DATALAKE_TAG
  azureClientId: AZURE_CLIENT_ID
  ldap:
    host: LDAP_HOST
    dn: LDAP_DN
    ou: LDAP_OU
    user: LDAP_USER_NAME
    password: LDAP_USER_PASSWORD


